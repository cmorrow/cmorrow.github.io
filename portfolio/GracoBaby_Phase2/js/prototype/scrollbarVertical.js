/**
 * @author Ryan Johnson <http://syntacticx.com/>
 * @copyright 2008 PersonalGrid Corporation <http://personalgrid.com/>
 * @package LivePipe UI
 * @license MIT
 * @url http://livepipe.net/control/scrollbar
 * @require prototype.js, slider.js, livepipe.js
 */
if("undefined"==typeof Prototype)throw"Control.ScrollBarVertical requires Prototype to be loaded.";if("undefined"==typeof Control.Slider)throw"Control.ScrollBarVertical requires Control.Slider to be loaded.";if("undefined"==typeof Object.Event)throw"Control.ScrollBarVertical requires Object.Event to be loaded.";Control.ScrollBarVertical=Class.create({initialize:function(t,e,i){this.enabled=!1,this.notificationTimeout=!1,this.container=$(t),this.boundMouseWheelEvent=this.onMouseWheel.bindAsEventListener(this),this.boundResizeObserver=this.onWindowResize.bind(this),this.track=$(e),this.handle=this.track.firstDescendant(),this.options=Object.extend({active_class_name:"scrolling",apply_active_class_name_to:this.container,notification_timeout_length:125,handle_minimum_height:32,scroll_to_smoothing:.01,scroll_to_steps:15,proportional:!0,slider_options:{}},i||{}),this.slider=new Control.Slider(this.handle,this.track,Object.extend({axis:"vertical",onSlide:this.onChange.bind(this),onChange:this.onChange.bind(this)},this.options.slider_options)),this.recalculateLayout(),Event.observe(window,"resize",this.boundResizeObserver),this.handle.observe("mousedown",function(){this.auto_sliding_executer&&this.auto_sliding_executer.stop()}.bind(this))},destroy:function(){Event.stopObserving(window,"resize",this.boundResizeObserver)},enable:function(){this.enabled=!0,this.container.observe("mouse:wheel",this.boundMouseWheelEvent),this.slider.setEnabled(),this.track.show(),this.options.active_class_name&&$(this.options.apply_active_class_name_to).addClassName(this.options.active_class_name),this.notify("enabled")},disable:function(){this.enabled=!1,this.container.stopObserving("mouse:wheel",this.boundMouseWheelEvent),this.slider.setDisabled(),this.track.hide(),this.options.active_class_name&&$(this.options.apply_active_class_name_to).removeClassName(this.options.active_class_name),this.notify("disabled"),this.reset()},reset:function(){this.slider.setValue(0)},recalculateLayout:function(){this.container.scrollHeight<=this.container.offsetHeight?this.disable():(this.slider.trackLength=this.slider.maximumOffset()-this.slider.minimumOffset(),this.options.proportional&&(this.handle.style.height=Math.max(this.container.offsetHeight*(this.container.offsetHeight/this.container.scrollHeight)-32-10,this.options.handle_minimum_height)+"px",this.slider.handleLength=this.handle.style.height.replace(/px/,"")),this.enable())},onWindowResize:function(){this.recalculateLayout(),this.scrollBy(0)},onMouseWheel:function(t){return this.auto_sliding_executer&&this.auto_sliding_executer.stop(),this.slider.setValueBy(-(t.memo.delta/20)),t.stop(),!1},onChange:function(t){this.container.scrollTop=Math.round(t/this.slider.maximum*(this.container.scrollHeight-this.container.offsetHeight)),this.notification_timeout&&window.clearTimeout(this.notificationTimeout),this.notificationTimeout=window.setTimeout(function(){this.notify("change",t)}.bind(this),this.options.notification_timeout_length)},getCurrentMaximumDelta:function(){return this.slider.maximum*(this.container.scrollHeight-this.container.offsetHeight)},getDeltaToElement:function(t){return this.slider.maximum*(t.positionedOffset().top+t.getHeight()/2-this.container.getHeight()/2)},scrollTo:function(t,e){var i=this.getCurrentMaximumDelta();if("top"==t?t=0:"bottom"==t?t=i:"number"!=typeof t&&(t=this.getDeltaToElement($(t))),this.enabled){t=Math.max(0,Math.min(t,i)),this.auto_sliding_executer&&this.auto_sliding_executer.stop();var s=t/i,o=this.slider.value,n=(s-o)*i;e?this.auto_sliding_executer=new PeriodicalExecuter(function(){Math.round(100*this.slider.value)/100<Math.round(100*s)/100||Math.round(100*this.slider.value)/100>Math.round(100*s)/100?this.scrollBy(n/this.options.scroll_to_steps):(this.auto_sliding_executer.stop(),this.auto_sliding_executer=null,"function"==typeof e&&e())}.bind(this),this.options.scroll_to_smoothing):this.scrollBy(n)}else"function"==typeof e&&e()},scrollBy:function(t){return this.enabled?(this.slider.setValueBy(t/this.getCurrentMaximumDelta()),void 0):!1}}),Object.Event.extend(Control.ScrollBarVertical);