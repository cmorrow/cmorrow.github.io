/**
 * jQuery Lightbox Plugin (balupton edition) - Lightboxes for jQuery
 * Copyright (C) 2008 Benjamin Arthur Lupton
 * http://jquery.com/plugins/project/jquerylightbox_bal
 *
 * This file is part of jQuery Lightbox (balupton edition).
 * 
 * jQuery Lightbox (balupton edition) is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 * 
 * jQuery Lightbox (balupton edition) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 * 
 * You should have received a copy of the GNU Affero General Public License
 * along with jQuery Lightbox (balupton edition).  If not, see <http://www.gnu.org/licenses/>.
 *
 * @name jquery_lightbox: jquery.lightbox.js
 * @package jQuery Lightbox Plugin (balupton edition)
 * @version 1.3.4-final
 * @date September 12, 2008
 * @category jQuery plugin
 * @author Benjamin "balupton" Lupton {@link http://www.balupton.com}
 * @copyright (c) 2008 Benjamin Arthur Lupton {@link http://www.balupton.com}
 * @license GNU Affero General Public License - {@link http://www.gnu.org/licenses/agpl.html}
 * @example Visit {@link http://jquery.com/plugins/project/jquerylightbox_bal} for more information.
 */
!function($){$.log=$.browser.safari||"undefined"==typeof window.console||"function"!=typeof window.console.log?function(){}:window.console.log,$.params_to_json=$.params_to_json||function(params){if(params=String(params),params=params.substring(params.indexOf("?")+1),params=params.replace(/\+/g,"%20"),"{"===params.substring(0,1)&&"}"===params.substring(params.length-1))return eval(decodeURIComponent(params));params=params.split(/\&|\&amp\;/);for(var json={},i=0,n=params.length;n>i;++i){var param=params[i]||null;if(null!==param&&(param=param.split("="),null!==param)){var key=param[0]||null;if(null!==key&&"undefined"!=typeof param[1]){var value=param[1];key=decodeURIComponent(key),value=decodeURIComponent(value);try{value=eval(value)}catch(e){}var keys=key.split(".");if(1===keys.length)json[key]=value;else{var path="";for(ii in keys)key=keys[ii],path+="."+key,eval("json"+path+" = json"+path+" || {}");eval("json"+path+" = value")}}}}return json},$.LightboxClass=function(){this.construct()},$.fn.lightbox=function(i){if($.Lightbox=$.Lightbox||new $.LightboxClass,$.Lightbox.ie6&&!$.Lightbox.ie6_support)return this;i=$.extend({start:!1,events:!0},i);var t=$(this);if(i.events&&($(t).unbind().click(function(){var i=$(this);return $.Lightbox.init($(i)[0],t)?$.Lightbox.start()?!1:!1:!1}),$(t).addClass("lightbox-enabled")),i.start){var e=$(this);if(!$.Lightbox.init($(e)[0],t))return this;if(!$.Lightbox.start())return this}return this},$.extend($.LightboxClass.prototype,{images:{list:[],image:!1,prev:function(i){return"undefined"!=typeof i||(i=this.active())?this.first(i)?!1:this.get(i.index-1):i},next:function(i){return"undefined"!=typeof i||(i=this.active())?this.last(i)?!1:this.get(i.index+1):i},first:function(i){return"undefined"==typeof i?this.get(0):0===i.index},last:function(i){return"undefined"==typeof i?this.get(this.size()-1):i.index===this.size()-1},single:function(){return 1===this.size()},size:function(){return this.list.length},empty:function(){return 0===this.size()},clear:function(){this.list=[],this.image=!1},active:function(i){return"undefined"==typeof i?this.image:i===!1||(i=this.get(i))?(this.image=i,!0):i},add:function(i){if(i[0]){for(var t=0;t<i.length;t++)this.add(i[t]);return!0}var e=this.create(i);return e?(e.index=this.size(),this.list.push(e),!0):e},create:function(i){var t={src:"",title:"Untitled",description:"",name:"",index:-1,color:null,width:null,height:null,image:!0};if(i.image)t.src=i.src||t.src,t.title=i.title||t.title,t.description=i.description||t.description,t.name=i.name||t.name,t.color=i.color||t.color,t.width=i.width||t.width,t.height=i.height||t.height,t.index=i.index||t.index;else if(i.tagName)if(i=$(i),i.attr("src")||i.attr("href")){t.src=i.attr("src")||i.attr("href"),t.title=i.attr("title")||i.attr("alt")||t.title,t.name=i.attr("name")||"",t.color=i.css("backgroundColor");var e=t.title.indexOf(": ");e>0&&(t.description=t.title.substring(e+2)||t.description,t.title=t.title.substring(0,e)||t.title)}else t=!1;else t=!1;return t?t:($.log("ERROR","We dont know what we have:",i),!1)},get:function(i){if("undefined"==typeof i||null===i)return this.active();if("number"==typeof i)i=this.list[i]||!1;else{if(i=this.create(i),!i)return!1;for(var t=!1,e=0;e<this.size();e++){var o=this.list[e];o.src===i.src&&o.title===i.title&&o.description===i.description&&(t=o)}i=t}return i?i:($.log("ERROR","The desired image doesn't exist: ",i,this.list),!1)},debug:function(){return $.Lightbox.debug(arguments)}},constructed:!1,src:null,baseurl:null,files:{js:{lightbox:"js/jquery.lightbox.js",colorBlend:"js/jquery.color.js"},css:{lightbox:"css/jquery.lightbox.css"},images:{prev:"images/lbPrevious.gif",next:"images/lbNext.gif",blank:"images/blank.gif",loading:"..../images/loading.gif"}},text:{image:"Image",of:"of",close:"",closeInfo:"You can also click anywhere outside the image to close.",download:"Direct link to download the image.",help:{close:"",interact:""},about:{text:"",title:"Licenced under the GNU Affero General Public License.",link:"http://jquery.com/plugins/project/jquerylightbox_bal"}},keys:{close:"c",prev:"p",next:"n"},handlers:{show:null},opacity:.9,padding:null,speed:400,rel:"lightbox",auto_relify:!0,auto_scroll:"follow",auto_resize:!0,ie6:null,ie6_support:!0,ie6_upgrade:!1,colorBlend:null,download_link:!0,show_linkback:!0,show_info:"auto",show_extended_info:"false",options:["auto_scroll","auto_resize","download_link","show_info","show_extended_info","ie6_support","ie6_upgrade","colorBlend","baseurl","files","text","show_linkback","keys","opacity","padding","speed","rel","auto_relify"],construct:function(t){var e="undefined"==typeof this.constructed||this.constructed===!1;this.constructed=!0;var o=e;if(t=$.extend({},t),e&&"undefined"==typeof t.files)if(this.src=$("script[src*="+this.files.js.lightbox+"]:first").attr("src"),this.src){this.baseurl=this.src.substring(0,this.src.indexOf(this.files.js.lightbox));var s=this;$.each(this.files,function(i){$.each(this,function(t,e){s.files[i][t]=s.baseurl+e})}),delete s,t=$.extend(t,$.params_to_json(this.src))}else o=!1;else if("object"==typeof t.files){var s=this;$.each(t.files,function(){$.each(this,function(i,t){this[i]=s.baseurl+t})}),delete s}else o=!1;for(i in this.options){var n=this.options[i];"object"==typeof t[n]&&"object"==typeof this[n]?this[n]=$.extend(this[n],t[n]):"undefined"!=typeof t[n]&&(this[n]=t[n])}return this.ie6=e&&navigator.userAgent.indexOf("MSIE 6")>=0?!0:!1,(o||"undefined"!=typeof t.download_link||"undefined"!=typeof t.colorBlend||"object"==typeof t.files||"object"==typeof t.text||"undefined"!=typeof t.show_linkback||"undefined"!=typeof t.scroll_with)&&$(function(){$.Lightbox.domReady()}),!0},domReady:function(){var i=document.getElementsByTagName($.browser.safari?"head":"body")[0],t=this.files.css,e=this.files.js;this.ie6&&this.ie6_upgrade&&(e.ie6="http://www.savethedevelopers.org/say.no.to.ie.6.js"),this.colorBlend===!0&&"undefined"==typeof $.colorBlend?this.colorBlend=!0:(this.colorBlend="undefined"!=typeof $.colorBlend,delete e.colorBlend);for(stylesheet in t){var o=document.createElement("link");o.type="text/css",o.rel="stylesheet",o.media="screen",o.href=t[stylesheet],o.id="lightbox-stylesheet-"+stylesheet.replace(/[^a-zA-Z0-9]/g,""),$("#"+o.id).remove(),i.appendChild(o)}for(script in e){var s=document.createElement("script");s.type="text/javascript",s.src=e[script],s.id="lightbox-script-"+script.replace(/[^a-zA-Z0-9]/g,""),$("#"+s.id).remove(),i.appendChild(s)}return delete e,delete t,delete i,$("#lightbox,#lightbox-overlay").remove(),$("body").append('<div id="lightbox-overlay"><div id="lightbox-overlay-text">'+(this.show_linkback?'<p><span id="lightbox-overlay-text-about"><a href="#" title="'+this.text.about.title+'">'+this.text.about.text+"</a></span></p><p>&nbsp;</p>":"")+'<p><span id="lightbox-overlay-text-close">'+this.text.help.close+'</span><br/>&nbsp;<span id="lightbox-overlay-text-interact">'+this.text.help.interact+'</span></p></div></div><div id="lightbox"><div id="lightbox-top"><div id="lightbox-topleft"></div><a class="close" href="javascript:void(0);">close</a><span id="lightbox-caption">'+(this.download_link?'<a href="#" title="'+this.text.download+'" id="lightbox-caption-title"></a>':'<span id="lightbox-caption-title"></span>')+'<span id="lightbox-caption-seperator"></span><span id="lightbox-caption-description"></span></span></div><div id="lightbox-imageBox"><div id="lightbox-imageContainer"><img id="lightbox-image" /><div id="lightbox-nav"><a href="#" id="lightbox-nav-btnPrev"></a><a href="#" id="lightbox-nav-btnNext"></a></div><div id="lightbox-loading"><a href="#" id="lightbox-loading-link"><img src="'+this.files.images.loading+'" /></a></div></div></div><div id="lightbox-infoBox"><div id="lightbox-infoContainer"><div id="lightbox-infoHeader"><span id="lightbox-currentNumber"></span><div id="botRight"></div></div><div id="lightbox-infoFooter"><span id="lightbox-close"><a href="#" id="lightbox-close-button" title="'+this.text.closeInfo+'">'+this.text.close+'</a></span></div><div id="lightbox-infoContainer-clear"></div></div></div></div>'),this.resizeBoxes(),this.repositionBoxes(),$("#lightbox,#lightbox-overlay,#lightbox-overlay-text-interact").hide(),this.ie6&&this.ie6_support&&$("#lightbox-overlay").css({position:"absolute",top:"0px",left:"0px"}),$.each(this.files.images,function(){var i=new Image;i.onload=function(){i.onload=null,i=null},i.src=this}),$(window).unbind().resize(function(){$.Lightbox.resizeBoxes("resized")}),"follow"===this.scroll&&$(window).scroll(function(){$.Lightbox.repositionBoxes()}),$("#lightbox-nav-btnPrev").unbind().hover(function(){$(this).css({background:"url("+$.Lightbox.files.images.prev+") left 45% no-repeat"})},function(){$(this).css({background:"transparent url("+$.Lightbox.files.images.blank+") no-repeat"})}).click(function(){return $.Lightbox.showImage($.Lightbox.images.prev()),!1}),$("#lightbox-nav-btnNext").unbind().hover(function(){$(this).css({background:"url("+$.Lightbox.files.images.next+") right 45% no-repeat"})},function(){$(this).css({background:"transparent url("+$.Lightbox.files.images.blank+") no-repeat"})}).click(function(){return $.Lightbox.showImage($.Lightbox.images.next()),!1}),this.show_linkback&&$("#lightbox-overlay-text-about a").click(function(){return window.open($.Lightbox.text.about.link),!1}),$("#lightbox-overlay-text-close").unbind().hover(function(){$("#lightbox-overlay-text-interact").fadeIn()},function(){$("#lightbox-overlay-text-interact").fadeOut()}),$("#lightbox-caption-title").click(function(){return window.open($(this).attr("href")),!1}),$("#lightbox-overlay, #lightbox, #lightbox-loading-link, #lightbox-btnClose").unbind().click(function(){return $.Lightbox.finish(),!1}),this.auto_relify&&this.relify(),!0},relify:function(){var i={},t=0,e=this.rel;return $.each($("[@rel*="+e+"]"),function(o,s){var n=$(s).attr("rel");n===e&&(n=t),"undefined"==typeof i[n]&&(i[n]=[],t++),i[n].push(s)}),$.each(i,function(i,t){$(t).lightbox()}),!0},init:function(i,t){return"undefined"==typeof t&&(t=i,i=0),this.images.clear(),this.images.add(t)?this.images.empty()?($.log("WARNING","Lightbox started, but no images: ",i,t),!1):this.images.active(i)?!0:!1:!1},start:function(){return this.visible=!0,"disable"===this.scroll&&$(document.body).css("overflow","hidden"),$("embed, object, select").css("visibility","hidden"),this.resizeBoxes("general"),this.repositionBoxes({speed:0}),$("#lightbox-infoFooter").hide(),$("#lightbox-image,#lightbox-nav,#lightbox-nav-btnPrev,#lightbox-nav-btnNext").hide(),$("#lightbox-overlay").css("opacity",this.opacity).fadeIn(400,function(){return $("#lightbox").fadeIn(300),$.Lightbox.showImage($.Lightbox.images.active())?void 0:($.Lightbox.finish(),!1)}),!0},finish:function(){$("#lightbox").hide(),$("#lightbox-overlay").fadeOut(function(){$("#lightbox-overlay").hide()}),$("embed, object, select").css({visibility:"visible"}),this.images.active(!1),"disable"===this.scroll&&$(document.body).css("overflow","visible"),this.visible=!1},resizeBoxes:function(i){if("transition"!==i){var t=$(this.ie6?document.body:document);$("#lightbox-overlay").css({width:t.width(),height:t.height()}),delete t}switch(i){case"general":return!0;case"resized":if(this.auto_resize===!1)return this.repositionBoxes({nHeight:b,speed:this.speed}),!0;case"transition":}var e=this.images.active();if(!e||!e.width||!this.visible)return $.log("WARNING","A resize occured while no image or no lightbox..."),!1;var o=e.width,s=e.height,n=$(window).width(),a=$(window).height();if(this.auto_resize!==!1)for(var l,r=Math.floor(.8*n),h=Math.floor(.8*a);o>r||s>h;)o>r&&(l=r/o,o=r,s=Math.floor(s*l)),s>h&&(l=h/s,s=h,o=Math.floor(o*l));var d=$("#lightbox-imageBox").width(),g=$("#lightbox-imageBox").height(),c=o+2*this.padding,b=s+2*this.padding,u=d-c,f=g-b;$("#lightbox-nav-btnPrev,#lightbox-nav-btnNext").css("height",b);var p=c+18,x=c+18;return"transition"===i?0===u&&0===f?(this.pause(this.speed/3),this.showImage(null,3)):($("#lightbox-image").width(o).height(s),$("#lightbox-infoBox").animate({width:p},this.speed),$("#lightbox-top").animate({width:x},this.speed),$("#lightbox-imageBox").animate({width:c,height:b},this.speed,function(){$.Lightbox.showImage(null,3)})):($("#lightbox-image").animate({width:o,height:s},this.speed),$("#lightbox-imageBox").animate({width:c,height:b},this.speed)),this.repositionBoxes({nHeight:b,speed:this.speed}),!0},repositioning:!1,reposition_failsafe:!1,repositionBoxes:function(i){if(this.repositioning)return this.reposition_failsafe=!0,null;this.repositioning=!0,i=$.extend({},i),i.callback=i.callback||null,i.speed=i.speed||"slow";var t=this.getPageScroll(),e=i.nHeight||parseInt($("#lightbox").height(),10),o=t.yScroll+($(window).height()-e)/2.5,s=t.xScroll,n={left:s,top:o};return i.speed?$("#lightbox").animate(n,"slow",function(){$.Lightbox.reposition_failsafe?($.Lightbox.repositioning=$.Lightbox.reposition_failsafe=!1,$.Lightbox.repositionBoxes(i)):($.Lightbox.repositioning=!1,i.callback&&i.callback())}):($("#lightbox").css(n),this.reposition_failsafe?(this.repositioning=this.reposition_failsafe=!1,this.repositionBoxes(i)):this.repositioning=!1),!0},visible:!1,showImage:function(i,t){if(i=this.images.get(i),!i)return i;t=t||1;var e=t>1&&this.images.active().src!==i.src,o=t>2&&$("#lightbox-image").attr("src")!==i.src;switch((e||o)&&($.log("We wanted to skip a few steps: ",i,t,e,o),t=1),t){case 1:if(this.KeyboardNav_Disable(),$("#lightbox-loading").show(),$("#lightbox-image,#lightbox-nav,#lightbox-nav-btnPrev,#lightbox-nav-btnNext").hide(),$("#lightbox-imageBox").unbind(),!this.images.active(i))return!1;if(i.width&&i.height)this.showImage(null,2);else{var s=new Image;s.onload=function(){i.width=s.width,i.height=s.height,$.Lightbox.showImage(null,2),s.onload=null,s=null},s.src=i.src}break;case 2:$("#lightbox-image").attr("src",i.src),("undefined"==typeof this.padding||null===this.padding||isNaN(this.padding))&&(this.padding=parseInt($("#lightbox-imageContainer").css("padding-left"),10)||parseInt($("#lightbox-imageContainer").css("padding"),10)||0),this.colorBlend&&($("#lightbox-overlay").animate({backgroundColor:i.color},2*this.speed),$("#lightbox-imageBox").css("borderColor",i.color)),this.resizeBoxes("transition");break;case 3:$("#lightbox-loading").hide(),$("#lightbox-image").fadeIn(1.5*this.speed,function(){$.Lightbox.showImage(null,4)}),this.preloadNeighbours(),null!==this.handlers.show&&this.handlers.show(i);break;case 4:var n=$("#lightbox-caption-title").html(i.title||"Untitled");this.download_link&&n.attr("href",this.download_link?i.src:""),delete n,$("#lightbox-caption-seperator").html(i.description?": ":""),$("#lightbox-caption-description").html(i.description||"&nbsp;"),this.images.size()>1?$("#lightbox-currentNumber").html(this.text.image+"&nbsp;"+(i.index+1)+"&nbsp;"+this.text.of+"&nbsp;"+this.images.size()):$("#lightbox-currentNumber").html("&nbsp;"),this.show_extended_info===!0?($("#lightbox-imageBox").trigger("mouseover"),$("#lightbox-infoBox").trigger("mouseover")):this.show_info===!0&&$("#lightbox-imageBox").trigger("mouseover"),$("#lightbox-nav-btnPrev, #lightbox-nav-btnNext").css({background:"transparent url("+this.files.images.blank+") no-repeat"}),this.images.first(i)||$("#lightbox-nav-btnPrev").show(),this.images.last(i)||$("#lightbox-nav-btnNext").show(),$("#lightbox-nav").show(),this.KeyboardNav_Enable();break;default:return $.log("ERROR","Don't know what to do: ",i,t),this.showImage(i,1)}return!0},preloadNeighbours:function(){if(this.images.single()||this.images.empty())return!0;var i=this.images.active();if(!i)return i;var t,e=this.images.prev(i);e&&(t=new Image,t.src=e.src);var o=this.images.next(i);o&&(t=new Image,t.src=o.src)},KeyboardNav_Enable:function(){$(document).keydown(function(i){$.Lightbox.KeyboardNav_Action(i)})},KeyboardNav_Disable:function(){$(document).unbind()},KeyboardNav_Action:function(i){i=i||window.event;var t=i.keyCode,e=i.DOM_VK_ESCAPE||27,o=String.fromCharCode(t).toLowerCase();return o===this.keys.close||t===e?$.Lightbox.finish():o===this.keys.prev||37===t?$.Lightbox.showImage($.Lightbox.images.prev()):o===this.keys.next||39===t?$.Lightbox.showImage($.Lightbox.images.next()):!0},getPageScroll:function(){var i,t;self.pageYOffset?(t=self.pageYOffset,i=self.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(t=document.documentElement.scrollTop,i=document.documentElement.scrollLeft):document.body&&(t=document.body.scrollTop,i=document.body.scrollLeft);var e={xScroll:i,yScroll:t};return e},pause:function(i){var t=new Date,e=null;do e=new Date;while(i>e-t)}}),"undefined"==typeof $.Lightbox&&($.Lightbox=new $.LightboxClass)}(jQuery);