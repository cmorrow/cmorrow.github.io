/*
jquery.combobox
version 0.1.2.3 alpha

ahura mazda
copyright 2007
jquery.sanchezsalvador.com
*/
jQuery.fn.combobox=function(o){var t={comboboxContainerClass:null,comboboxValueContainerClass:null,comboboxValueContentClass:null,comboboxDropDownButtonClass:null,comboboxDropDownClass:null,comboboxDropDownItemClass:null,comboboxDropDownItemHoverClass:null,comboboxDropDownGroupItemHeaderClass:null,comboboxDropDownGroupItemContainerClass:null,animationType:"slide",width:"120px"};return o&&jQuery.extend(t,o),this.onChange=function(){},this.each(function(){function o(o,t){var e=o.outerWidth()-o.width();o.width(t-e)}function e(o,t){var e=o.outerHeight()-o.height();o.height(t-e)}function n(){var o="";o=t.comboboxValueContainerClass?String.format("<div class='{0}' style='{1}'></div>",t.comboboxValueContainerClass,X):String.format("<div style='{0}'></div>",X);var e="";e=t.comboboxValueContentClass?String.format("<div class='{0}' style='{1}'></div>",t.comboboxValueContentClass,Z):String.format("<div style='{0}'></div>",Z);var n="";n=t.comboboxDropDownButtonClass?String.format("<div class='{1}' style='{0}'></div>",tt,t.comboboxDropDownButtonClass):String.format("<div style='{0}'>{1}</div>",tt+ot,at),Y=jQuery(e),_=jQuery(n),N=jQuery(o),N.appendTo(E),Y.appendTo(N),_.appendTo(N),l(0)}function a(o){var e="",n=null,a="",i=null,r="",s="option";o.is("option")?(a=o.text(),i=o.val(),t.comboboxDropDownItemClass?(n=t.comboboxDropDownItemClass,r=U):r=U+q,e=n?String.format("<li style='{0}' class='{1}'>{2}</li>",r,n,a):String.format("<li style='{0}'>{1}</li>",r,a)):(a=o.attr("label"),i=o.attr("class"),s="optgroup",t.comboboxDropDownGroupItemHeaderClass?(n=t.comboboxDropDownGroupItemHeaderClass,r=J):r=J+M,e=n?String.format("<li><span style='{0}' class='{1}'>{2}</span></li>",r,n,a):String.format("<li><span style='{0}'>{1}</span></li>",r,a));var l=jQuery(e);return l.css("display","inline"),l[0].dataValue=i,l[0].dataType=s,l[0].title=a,l}function i(o,e){e.each(function(){var e=jQuery(this),n=a(e);o.append(n);var r=n.offset().left;r-=ct.left,0>r&&(r=0);var l=r+n.outerWidth();if(l>lt&&(lt=l),s(n,U),e.is("optgroup")){var c="";c=t.comboboxDropDownGroupItemContainerClass?String.format("<ul style='{0}' class='{1}'></ul>",A,t.comboboxDropDownGroupItemContainerClass):String.format("<ul style='{0}'></ul>",A+F);var u=jQuery(c);n.append(u),i(u,e.children())}})}function r(){var o=z.children();if(it=null,rt=null,L)L.empty();else{var e="";e=t.comboboxDropDownClass?String.format("<ul class='{0}' style='{1}'></ul>",t.comboboxDropDownClass,O):String.format("<ul style='{0}'></ul>",O+R),L=jQuery(e),L.appendTo(E),L.attr("tabIndex",0)}o.length>0&&(lt=0,ct=L.offset(),i(L,o))}function s(o,t){var e=t.split(";");if(e.length>0)for(var n=0;n<e.length;n++){var a=e[n],i=a.split(":");o.css(i[0],i[1])}}function l(o){if(t.comboboxDropDownButtonClass){var e=_.width(),n=o*e,a=String.format("-{0}px 0px",n);_.css("background-position",a)}else{var i=et;1==o&&(i=nt),s(_,i)}}function c(){var o=E.outerWidth();lt>o&&(o=lt),L.width(o)}function u(){var o=Y.outerHeight(),t=N.height(),e=(t-o)/2;0>e&&(e=0),Y.css("top",e)}function d(){E.width(t.width);var n=E.width();o(N,n);var a=N.width()-_.outerWidth();o(Y,a);var i=_.outerHeight();e(N,i),L.css("position","absolute"),L.css("z-index","20000"),c();var r=L.offset().left,s=r-(E.outerWidth()-E.width());L.css("left",s+1),L.hide()}function f(){jQuery("*",L).not("ul").not("span").not("[@dataType='optgroup']").each(function(){var o=jQuery(this);o.click(function(t){t.stopPropagation(),V(o)}),o.mouseover(function(){G(o)}),o.mouseout(function(){B(o)})})}function p(){L.blur(function(o){o.stopPropagation(),T()})}function b(){E.click(function(){H()})}function h(){E.unbind("click")}function m(){E.keydown(function(o){o.preventDefault(),W(o)}),b(),p(),f()}function g(){var o=!1,t=z[0];if(t.length>0){var e=t[t.selectedIndex].text;Y.text(e),Y.attr("title",e),u(),rt&&rt!=z.val()&&(o=!0),rt=z.val(),o&&z.combobox.onChange&&z.combobox.onChange(),it&&x(it,!1),it=jQuery("li[@dataValue='"+rt+"']",L),x(it,!0)}}function x(o,e){o&&(t.comboboxDropDownItemHoverClass?e?o.addClass(t.comboboxDropDownItemHoverClass):o.removeClass(t.comboboxDropDownItemHoverClass):e?(o.css("background","#000"),o.css("color","#fff")):(o.css("background",""),o.css("color","")))}function v(){var o="";o=t.comboboxContainerClass?String.format("<div class='{0}' style='{1}'></div>",t.comboboxContainerClass,P):String.format("<div style='{0}' style='{1}'></div>",K,P),E=jQuery(o),z.before(E),E.append(z),z.hide(),E.attr("tabIndex",0)}function w(){v(),n(),r(),d(),m(),g()}function y(){L.focus()}function C(){E.focus(),b()}function D(o){L.animate({height:"toggle",top:o},"fast",y)}function k(o){L.animate({height:"toggle",top:o},"fast",C)}function I(){var o,t=E.position().top,e=L.outerHeight(),n=t+E.outerHeight(),a=jQuery(window).scrollTop(),i=jQuery(window).height(),r=i-(n-a);return o=n,st=!1,e>r&&t-a>e&&(o=t-e,st=!0),o}function S(o){if(o){if(L.is(":hidden")){h(),x(it,!0),l(1);var e=I();switch(L.css("top",e),L.css("left",E.offset().left),t.animationType){case"slide":if(st){var n=E.position().top,a=E.outerHeight();L.css("top",n-a),D(e)}else L.slideDown("fast",y);break;case"fade":L.fadeIn("fast",y);break;default:L.show(),y()}}}else if(L.is(":visible"))switch(l(0),t.animationType){case"slide":st?(n=E.position().top,dropdownListHeight=L.height(),k(n-E.outerHeight())):L.slideUp("fast",C);break;case"fade":L.fadeOut("fast",C);break;default:L.hide(),C()}}function j(o){var t=z[0],e=t.selectedIndex,n=-1,a=t.length-1;switch(o){case":next":n=e+1,n>a&&(n=a);break;case":previous":n=e-1,0>n&&(n=0);break;case":first":n=0;break;case":last":n=a}t.selectedIndex=n,g()}function Q(){return L.is(":visible")}function H(){L.is(":hidden")?S(!0):S(!1)}function T(){L.is(":visible")&&S(!1)}function V(o){z.val(o[0].dataValue),g(),S(!1)}function G(o){x(it,!1),x(o,!0)}function B(o){x(o,!1)}function W(o){switch(o.which){case 33:case 36:j(":first");break;case 34:case 35:j(":last");break;case 37:j(":previous");break;case 38:o.altKey?S(!Q()):j(":previous");break;case 39:j(":next");break;case 40:o.altKey?S(!Q()):j(":next");break;case 27:case 13:S(!1);break;case 9:L.blur(),$(window)[0].focus()}o.cancelBubble=!0}var z=jQuery(this),E=null,K="border-left: solid 2px #777;border-top: solid 2px #777;border-right: solid 1px #ccc;border-bottom: solid 1px #ccc;",P="padding:0;",L=null,O="list-style-type:none;min-height:15px;padding-top:0;margin:0;",R="cursor:default;padding:2px;background:#fff;border-right:solid 1px #000;border-bottom:solid 1px #000;border-left:solid 1px #aaa;border-top:solid 1px #aaa;overflow:auto",U="display:block;",q="cursor:default;padding-left:2px;font-weight:normal;font-style:normal;",A="list-style-type:none;",F="padding-left:10px;margin-left:0;",J="",M="font-style:italic;font-weight:bold;",N=null,X="position:relative;overflow:hidden;",Y=null,Z="float:left;position:absolute;cursor:default;overflow:hidden;",_=null,ot="overflow:hidden;width: 16px;height: 18px;color:#000;background: #D6D3CE;,font-family: verdana;font-size: 10px;cursor: default;text-align: center;vertical-align:middle;",tt="background-repeat:no-repeat;float:right;",et="padding-left:0px;padding-top:1px;width:12px;height:13px;border-right:solid 2px #404040;border-bottom:solid 2px #404040;border-left:solid 2px #f0f0f0;border-top:solid 2px #f0f0f0",nt="padding-left:1px;padding-top:3px;width:12px;height:13px;border:solid 1px #808080",at="&#9660;",it=null,rt=null,st=!1,lt=0,ct=null;String.format=function(){var o=null;if(0!=arguments.length){o=arguments[0];for(var t=1;t<arguments.length;t++){var e=new RegExp("\\{"+(t-1)+"\\}","gm");o=o.replace(e,arguments[t])}}return o},z.combobox.updateSelection=function(){g()},z.combobox.update=function(){r(),c(),f(),g()},w()})};